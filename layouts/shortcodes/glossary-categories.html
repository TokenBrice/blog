{{- $lang := .Page.Language.Lang -}}
{{- $categories := index .Site.Data.glossary.categories $lang -}}

<div class="glossary-categories-overview">
    {{- range $categories -}}
    <div class="category-card clickable-category" data-category-id="{{ .id }}" role="button" tabindex="0" title="{{ if eq $lang "fr" }}Cliquer pour filtrer par catégorie{{ else }}Click to filter by category{{ end }}">
        <h3 class="category-name">{{ .name }}</h3>
        <p class="category-description">{{ .description }}</p>
        <span class="category-count">
            {{- $termCount := len (where (index $.Site.Data.glossary $lang).terms "category" .id) -}}
            {{ if eq $lang "fr" }}{{ $termCount }} terme{{ if ne $termCount 1 }}s{{ end }}{{ else }}{{ $termCount }} term{{ if ne $termCount 1 }}s{{ end }}{{ end }}
        </span>
    </div>
    {{- end -}}
</div>

<style>
.glossary-categories-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.category-card {
    background: var(--card-background);
    border: 1px solid var(--card-border-color);
    border-left: 4px solid var(--card-border-color);
    border-radius: var(--card-border-radius);
    padding: 1.5rem;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-l1);
}

.category-card.clickable-category {
    cursor: pointer;
    user-select: none;
}

.category-card:hover {
    box-shadow: var(--shadow-l2);
    transform: translateY(-2px);
    border-color: var(--accent-color);
}

.category-card.clickable-category:hover {
    border-left-width: 6px;
}

.category-card:focus {
    outline: 2px solid var(--accent-color);
    outline-offset: 2px;
}

.category-name {
    margin: 0 0 0.5rem 0;
    color: var(--card-text-color-main);
    font-size: 1.2rem;
    font-weight: 700;
}

.category-description {
    margin: 0 0 1rem 0;
    color: var(--card-text-color-secondary);
    line-height: 1.4;
}

.category-count {
    background: var(--accent-color);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

@media (max-width: 768px) {
    .glossary-categories-overview {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
(function() {
    function getCategoryColor(categoryId) {
        const colors = {
            'yields': '#10B981',      // Green - for earning/returns
            'rendements': '#10B981',  // Green (French)
            'risks': '#EF4444',       // Red - for risks/security
            'risques': '#EF4444',     // Red (French)
            'strategies': '#8B5CF6',  // Purple - for strategies
            'stratégies': '#8B5CF6',  // Purple (French)
            'protocols': '#3B82F6',   // Blue - for protocols/platforms
            'protocoles': '#3B82F6',  // Blue (French)
            'tokens': '#F59E0B',      // Amber - for tokens/assets
            'technical': '#6B7280',   // Gray - for technical concepts
            'technique': '#6B7280',   // Gray (French)
            'trading': '#06B6D4',     // Cyan - for trading/AMMs
            'governance': '#EC4899',  // Pink - for governance/DAOs
            'gouvernance': '#EC4899', // Pink (French)
            // Additional unique colors for overlapping categories
            'defi-protocols': '#3B82F6',      // Keep blue for DeFi Protocols
            'trading-amms': '#06B6D4',        // Keep cyan for Trading & AMMs
            'governance-daos': '#EC4899',     // Keep pink for Governance & DAOs
            'technical-concepts': '#6366F1',  // Indigo - distinct from gray
            'lending-borrowing': '#059669',   // Emerald - distinct from green
            'stablecoins': '#F97316',         // Orange - distinct from amber
            'yield-farming': '#10B981'        // Green - same as yields
        };
        return colors[categoryId] || '#6B7280'; // Default to gray
    }
    
    function handleCategoryClick(categoryId) {
        // Check if we're on the glossary page and the filtering function exists
        if (typeof window.handleCategoryFilter === 'function') {
            window.handleCategoryFilter(categoryId);
        } else {
            // If the glossary app isn't loaded yet, scroll to it first
            const glossaryApp = document.getElementById('glossary-app');
            if (glossaryApp) {
                glossaryApp.scrollIntoView({ behavior: 'smooth' });
                // Store the category to filter after glossary loads
                window.pendingCategoryFilter = categoryId;
            }
        }
    }
    
    // Apply colors and click handlers when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        const categoryCards = document.querySelectorAll('.category-card[data-category-id]');
        categoryCards.forEach(card => {
            const categoryId = card.getAttribute('data-category-id');
            const color = getCategoryColor(categoryId);
            const countSpan = card.querySelector('.category-count');
            
            // Apply color to left border
            card.style.borderLeftColor = color;
            
            // Apply color to count badge
            if (countSpan) {
                countSpan.style.backgroundColor = color;
            }
            
            // Add click handler
            card.addEventListener('click', function(e) {
                e.preventDefault();
                handleCategoryClick(categoryId);
            });
            
            // Add keyboard support
            card.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleCategoryClick(categoryId);
                }
            });
        });
    });
})();
</script>
