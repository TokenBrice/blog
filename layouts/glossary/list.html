{{ define "body-class" }}
    article-page
{{ end }}

{{ define "main" }}
    <article class="{{ if .Params.image }}has-image {{ end }}main-article">
        <header class="article-header">
            <div class="article-details">
                {{ with .Params.categories }}
                    {{ partial "article/components/details" (dict "context" $ "scope" "categories") }}
                {{ end }}
                {{ with .Params.tags }}
                    {{ partial "article/components/details" (dict "context" $ "scope" "tags") }}
                {{ end }}
            </div>

            <h1 class="article-title">{{ .Title }}</h1>
            {{ with .Params.description }}
                <p class="article-subtitle">{{ . }}</p>
            {{ end }}
        </header>

        <section class="article-content">
            {{ .Content }}
            
            <div id="glossary-app" class="glossary-app">
                <!-- Quick Navigation -->
                <div class="alphabet-nav" id="alphabet-container"></div>

                <!-- Terms Display -->
                <div class="terms-wrapper">
                    <div id="terms-list" class="terms-list"></div>
                    <div id="no-results" class="no-results" style="display: none;">
                        <h3>{{ if eq .Language.Lang "fr" }}Aucun terme trouvé{{ else }}No terms found{{ end }}</h3>
                        <p>{{ if eq .Language.Lang "fr" }}Sélectionnez une autre catégorie.{{ else }}Try selecting a different category.{{ end }}</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Add article footer -->
        {{ partial "article/components/footer" . }}
    </article>
    
    <!-- Add related content section -->
    {{ partial "article/components/related-content" . }}
    
    <!-- Add footer as in other pages -->
    {{ partialCached "footer/footer" . }}

<!-- FAQ Schema for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "name": "{{ .Title }}",
  "description": "{{ .Description }}",
  "url": "{{ .Permalink }}",
  "mainEntity": [
    {{- $lang := .Language.Lang -}}
    {{- $glossaryData := index .Site.Data.glossary $lang -}}
    {{- $terms := $glossaryData.terms -}}
    {{- range $index, $term := $terms -}}
      {{- range $qIndex, $qa := $term.common_questions -}}
        {{- if or (gt $index 0) (gt $qIndex 0) }},{{ end }}
        {
          "@type": "Question",
          "name": {{ $qa.question | jsonify }},
          "acceptedAnswer": {
            "@type": "Answer",
            "text": {{ $qa.answer | jsonify }}
          }
        }
      {{- end -}}
    {{- end -}}
  ]
}
</script>

<!-- Glossary Data Injection (Hugo template variables) -->
<script>
window.glossaryConfig = {
    lang: '{{ .Language.Lang }}',
    glossaryData: {{ index .Site.Data.glossary .Language.Lang | jsonify | safeJS }},
    categories: {{ index .Site.Data.glossary.categories .Language.Lang | jsonify | safeJS }},
    sitePages: {
    {{- range .Site.RegularPages -}}
        {{- $url := .RelPermalink -}}
        {{- if .Params.url -}}
            {{- $customUrl := printf "/%s/" .Params.url -}}
            "{{ $customUrl }}": {
                url: "{{ $url }}",
                image: "{{ .Params.image | default "" }}",
                title: "{{ .Title }}"
            },
            "{{ $url }}": {
                url: "{{ $url }}",
                image: "{{ .Params.image | default "" }}",
                title: "{{ .Title }}"
            },
        {{- end -}}
        "{{ $url }}": {
            url: "{{ $url }}",
            image: "{{ .Params.image | default "" }}",
            title: "{{ .Title }}"
        },
    {{- end -}}
    }
};
</script>

<!-- Glossary JavaScript (external, minified, fingerprinted) -->
{{ $glossaryJS := resources.Get "js/glossary.js" | minify | fingerprint }}
<script src="{{ $glossaryJS.Permalink }}" defer></script>

<!-- Glossary CSS (external, minified, fingerprinted) -->
{{ $glossaryCSS := resources.Get "css/glossary.css" | minify | fingerprint }}
<link rel="stylesheet" href="{{ $glossaryCSS.Permalink }}">

{{ end }}
